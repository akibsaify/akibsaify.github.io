<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Harmonic Flow | Coherent Dynamics</title>
    <style>
        :root {
            --bg: #010103;
            --accent: #00d4ff;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
            overflow: hidden;
        }

        body {
            background-color: var(--bg);
            color: #fff;
            font-family: 'Inter', system-ui, sans-serif;
            width: 100vw;
            height: 100vh;
        }

        canvas {
            display: block;
            touch-action: none;
        }

        #ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 3rem;
            z-index: 10;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            opacity: 0.4;
        }

        .tag {
            font-size: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 0.3rem;
            font-weight: 700;
        }

        .center-msg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            opacity: 0;
            transition: opacity 1.5s ease;
        }

        .center-msg.visible { opacity: 0.15; }

        .controls {
            display: flex;
            gap: 2rem;
            pointer-events: auto;
        }

        .control-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        input[type="range"] {
            appearance: none;
            background: rgba(255, 255, 255, 0.1);
            height: 2px;
            width: 120px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 10px;
            height: 10px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
        }

        #intro-curtain {
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 2.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>
</head>
<body>

    <div id="intro-curtain">
        <div style="text-align: center;">
            <div style="width: 1px; height: 60px; background: white; margin: 0 auto 20px; animation: scaleY 2s infinite;"></div>
            <p style="letter-spacing: 0.5rem; font-size: 0.7rem; font-weight: 300;">HARMONIC RESONANCE</p>
        </div>
    </div>

    <div id="ui-overlay">
        <div class="header">
            <div class="tag">System: Coherent Field</div>
            <div class="tag">Status: Synchronized</div>
        </div>

        <div id="msg" class="center-msg visible">
            <h1 style="font-size: 3rem; font-weight: 100; letter-spacing: 1rem;">AETHER</h1>
            <p style="letter-spacing: 0.2rem; font-size: 0.8rem; margin-top: 10px;">Move to shape the resonance</p>
        </div>

        <div class="footer">
            <div class="controls">
                <div class="control-item">
                    <span class="tag" style="font-size: 0.5rem;">Density</span>
                    <input type="range" id="density" min="10" max="150" value="80">
                </div>
                <div class="control-item">
                    <span class="tag" style="font-size: 0.5rem;">Viscosity</span>
                    <input type="range" id="viscosity" min="90" max="99" value="96">
                </div>
                <div class="control-item">
                    <span class="tag" style="font-size: 0.5rem;">Field Force</span>
                    <input type="range" id="force" min="1" max="50" value="25">
                </div>
            </div>
        </div>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        /**
         * COHERENT FLOW ENGINE
         * Principles: Vector Field Smoothing & Streamline Integration
         */

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d', { alpha: false });
        
        let width, height;
        let lines = [];
        let tick = 0;
        
        const settings = {
            lineCount: 80,
            pointsPerLine: 40,
            segmentLength: 15,
            hue: 195,
            viscosity: 0.96,
            force: 0.25,
            mouse: { x: 0, y: 0, targetX: 0, targetY: 0, active: false }
        };

        class Streamline {
            constructor(yOffset) {
                this.yOffset = yOffset;
                this.points = [];
                this.hue = settings.hue + (Math.random() * 30 - 15);
                this.init();
            }

            init() {
                this.points = [];
                const startX = -50;
                const baseHeight = (height * this.yOffset);
                
                for (let i = 0; i < settings.pointsPerLine; i++) {
                    this.points.push({
                        x: startX + (i * (width / (settings.pointsPerLine - 5))),
                        y: baseHeight,
                        vx: 0,
                        vy: 0,
                        originalY: baseHeight
                    });
                }
            }

            update() {
                this.points.forEach((p, i) => {
                    // 1. Consistent Base Flow (Sine Harmonics)
                    const harmonic1 = Math.sin(tick * 0.02 + p.x * 0.002) * 20;
                    const harmonic2 = Math.cos(tick * 0.01 + p.x * 0.005) * 10;
                    const targetY = p.originalY + harmonic1 + harmonic2;

                    // 2. Field Force (Spring back to harmonic state)
                    p.vy += (targetY - p.y) * 0.02;

                    // 3. User Interaction (The Lenz Effect)
                    if (settings.mouse.active || true) {
                        const mx = settings.mouse.active ? settings.mouse.x : width / 2 + Math.cos(tick * 0.01) * width * 0.3;
                        const my = settings.mouse.active ? settings.mouse.y : height / 2 + Math.sin(tick * 0.02) * height * 0.2;
                        
                        const dx = mx - p.x;
                        const dy = my - p.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        
                        if (dist < 250) {
                            const force = (1 - dist / 250) * settings.force;
                            p.vx -= (dx / dist) * force;
                            p.vy -= (dy / dist) * force;
                        }
                    }

                    // 4. Consistent Velocity
                    p.vx *= settings.viscosity;
                    p.vy *= settings.viscosity;
                    
                    // Don't move horizontally much to keep "consistent" lanes
                    p.y += p.vy;
                    p.x += p.vx * 0.1; 
                });
            }

            draw() {
                ctx.beginPath();
                ctx.moveTo(this.points[0].x, this.points[0].y);

                for (let i = 1; i < this.points.length; i++) {
                    const p = this.points[i];
                    const prev = this.points[i - 1];
                    
                    // Bezier smoothing for consistent curves
                    const xc = (p.x + prev.x) / 2;
                    const yc = (p.y + prev.y) / 2;
                    ctx.quadraticCurveTo(prev.x, prev.y, xc, yc);
                }

                const gradient = ctx.createLinearGradient(0, 0, width, 0);
                gradient.addColorStop(0, `hsla(${this.hue}, 100%, 50%, 0)`);
                gradient.addColorStop(0.5, `hsla(${this.hue}, 100%, 50%, 0.4)`);
                gradient.addColorStop(1, `hsla(${this.hue}, 100%, 50%, 0)`);

                ctx.strokeStyle = gradient;
                ctx.lineWidth = 1.5;
                ctx.stroke();
            }
        }

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            initField();
        }

        function initField() {
            lines = [];
            const count = parseInt(document.getElementById('density').value);
            for (let i = 0; i <= count; i++) {
                lines.push(new Streamline(i / count));
            }
        }

        function loop() {
            tick++;
            
            // Minimalist clear with slight persistent glow
            ctx.fillStyle = 'rgba(1, 1, 3, 0.15)';
            ctx.fillRect(0, 0, width, height);

            // Global update based on UI
            settings.viscosity = document.getElementById('viscosity').value / 100;
            settings.force = document.getElementById('force').value / 100;

            lines.forEach(line => {
                line.update();
                line.draw();
            });

            requestAnimationFrame(loop);
        }

        // --- Interaction Listeners ---
        window.addEventListener('mousemove', (e) => {
            settings.mouse.x = e.clientX;
            settings.mouse.y = e.clientY;
            settings.mouse.active = true;
            document.getElementById('msg').classList.remove('visible');
            
            clearTimeout(settings.mouse.timer);
            settings.mouse.timer = setTimeout(() => {
                settings.mouse.active = false;
                document.getElementById('msg').classList.add('visible');
            }, 3000);
        });

        window.addEventListener('touchmove', (e) => {
            settings.mouse.x = e.touches[0].clientX;
            settings.mouse.y = e.touches[0].clientY;
            settings.mouse.active = true;
            document.getElementById('msg').classList.remove('visible');
        }, { passive: false });

        document.getElementById('density').addEventListener('input', initField);

        window.onload = () => {
            resize();
            requestAnimationFrame(loop);
            setTimeout(() => {
                document.getElementById('intro-curtain').style.opacity = '0';
                setTimeout(() => document.getElementById('intro-curtain').remove(), 2500);
            }, 1000);
        };

        window.addEventListener('resize', resize);
    </script>
</body>
</html>


