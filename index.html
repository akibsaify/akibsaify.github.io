<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>FIELD</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html,body{
  margin:0;
  background:#0b0b0f;
  overflow:hidden;
  cursor:crosshair;
}
canvas{display:block}
</style>
</head>
<body>
<canvas id="c"></canvas>
<script>
const c = document.getElementById("c");
const x = c.getContext("2d");
let w,h;
function resize(){w=c.width=innerWidth;h=c.height=innerHeight}
addEventListener("resize",resize);resize();

let balls=[];
let mouse={x:0,y:0,down:false};
let mode=0;

addEventListener("mousemove",e=>{mouse.x=e.clientX;mouse.y=e.clientY});
addEventListener("mousedown",()=>mouse.down=true);
addEventListener("mouseup",()=>mouse.down=false);
addEventListener("wheel",e=>{
  mode=(mode+Math.sign(e.deltaY)+4)%4;
});

addEventListener("keydown",e=>{
  if(e.key==="r") balls=[];
  if(e.key==="c") balls.forEach(b=>b.vx*=5);
  if(e.key==="s") slow=!slow;
});

class Ball{
  constructor(x,y,m){
    this.x=x;this.y=y;
    this.vx=(Math.random()-0.5)*6;
    this.vy=(Math.random()-0.5)*6;
    this.r=8+Math.sqrt(m)*6;
    this.m=m;
    this.h=Math.random()*360;
  }
  update(){
    if(mode===1)this.vy+=0.15*this.m;
    if(mode===2){
      let dx=mouse.x-this.x,dy=mouse.y-this.y;
      let d=Math.hypot(dx,dy)+1;
      this.vx+=dx/d*0.02;
      this.vy+=dy/d*0.02;
    }
    this.x+=this.vx;
    this.y+=this.vy;
    this.vx*=0.99;
    this.vy*=0.99;
    if(this.x<this.r||this.x>w-this.r)this.vx*=-1;
    if(this.y<this.r||this.y>h-this.r)this.vy*=-1;
  }
  draw(){
    x.beginPath();
    x.fillStyle=`hsla(${this.h},80%,60%,0.85)`;
    x.shadowBlur=20;
    x.shadowColor=`hsla(${this.h},80%,60%,0.4)`;
    x.arc(this.x,this.y,this.r,0,Math.PI*2);
    x.fill();
    x.shadowBlur=0;
  }
}

let charge=0;
function loop(){
  requestAnimationFrame(loop);
  x.fillStyle="rgba(11,11,15,0.2)";
  x.fillRect(0,0,w,h);

  if(mouse.down){
    charge+=0.02;
  }else if(charge>0){
    balls.push(new Ball(mouse.x,mouse.y,charge));
    charge=0;
  }

  balls.forEach(b=>{b.update();b.draw()});
}
loop();
</script>
</body>
</html>
